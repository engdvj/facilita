import{u as he,a as ve,r,j as l,H as ye,m as O,N as f,d as ee,L as le,F as je,e as ke,f as Ne,U as be,I as ae,P as Ce,T as _e,C as we,b as Le,c as d,V as I}from"./index-0f2bc97a.js";function Se(){const{id:U}=he(),k=ve(),[s,se]=r.useState(null),[N,te]=r.useState([]),[E,ie]=r.useState([]),[re,ne]=r.useState([]),[n,p]=r.useState({title:"",url:"",file_url:"",category_id:null,color:"",image_url:""}),[z,V]=r.useState("url"),[G,B]=r.useState(null),[T,R]=r.useState(!1),[J,P]=r.useState(null),[oe,ce]=r.useState([]),[b,D]=r.useState("link"),[t,C]=r.useState(null),[o,m]=r.useState({title:"",url:"",file_url:"",category_id:null,color:"",image_url:""}),[H,w]=r.useState("url"),[K,L]=r.useState(null),[A,x]=r.useState(!1),[Q,g]=r.useState(null),[h,v]=r.useState("link"),[_,W]=r.useState(1),M=5,[$,X]=r.useState(!1);r.useEffect(()=>{s&&!s.isAdmin&&(D("link"),R(!1),P(null),v("link"),x(!1),g(null))},[s]);const u="p-2 rounded-md border border-gray-300 dark:border-gray-700 bg-[var(--input-background)] text-white",q=r.useMemo(()=>{const e={};for(const a of E)e[a.id]=a;return e},[E]),S=async()=>{const[e,a,i,c,ge]=await Promise.all([d.get("/auth/me"),d.get("/links"),d.get("/categories"),d.get("/colors"),d.get("/schedules")]);se(e.data),te([...a.data].sort((y,j)=>y.title.localeCompare(j.title))),ie([...i.data].sort((y,j)=>y.name.localeCompare(j.name))),ne([...c.data].sort((y,j)=>(y.name||y.value).localeCompare(j.name||j.value))),ce(ge.data)};r.useEffect(()=>{S().catch(()=>k("/admin/login"))},[k]),r.useEffect(()=>{if(U&&N.length){const e=N.find(a=>a.id===Number(U));e&&(C(e.id),m({title:e.title,url:e.url,file_url:e.fileUrl??"",category_id:e.categoryId??null,color:e.color??"",image_url:e.imageUrl??""}),v(s!=null&&s.isAdmin&&e.fileUrl?"file":"link"),w("url"),L(null),x(!!e.fileUrl),g(null))}else C(null),x(!1),g(null),v("link")},[U,N]);const de=async e=>{e.preventDefault();try{const a={...n};if(b==="file"&&(s!=null&&s.isAdmin)&&(a.url=n.file_url),b==="link"&&T&&J){const i=new FormData;i.append("file",J);const c=await d.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"}});a.file_url=c.data.url}if(z==="file"&&G){const i=new FormData;i.append("file",G);const c=await d.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"}});a.image_url=c.data.url}s!=null&&s.isAdmin||(a.url=n.url,delete a.file_url),a.category_id===null&&delete a.category_id,a.file_url||delete a.file_url,await d.post("/links",a),I.success("Link criado"),await S(),p({title:"",url:"",file_url:"",category_id:null,color:"",image_url:""}),B(null),V("url"),P(null),R(!1),D("link")}catch{I.error("Erro ao criar link")}},ue=e=>{k(`/user/links/${e.id}`),C(e.id),m({title:e.title,url:e.url,file_url:e.fileUrl??"",category_id:e.categoryId??null,color:e.color??"",image_url:e.imageUrl??""}),w("url"),L(null),x(!!e.fileUrl),g(null)},me=async e=>{if(e.preventDefault(),t!==null)try{const a={...o};if(h==="file"&&(s!=null&&s.isAdmin)&&(a.url=o.file_url),h==="link"&&A&&Q&&(s!=null&&s.isAdmin)){const i=new FormData;i.append("file",Q);const c=await d.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"}});a.file_url=c.data.url}else h==="link"&&!A&&(s!=null&&s.isAdmin)&&(a.file_url=null);if(H==="file"&&K){const i=new FormData;i.append("file",K);const c=await d.post("/upload",i,{headers:{"Content-Type":"multipart/form-data"}});a.image_url=c.data.url}s!=null&&s.isAdmin||delete a.file_url,a.category_id===null&&delete a.category_id,a.file_url||delete a.file_url,await d.patch(`/links/${t}`,a),I.success("Link atualizado"),C(null),L(null),w("url"),g(null),x(!1),v("link"),await S(),k("/user/links")}catch{I.error("Erro ao atualizar")}},fe=async e=>{confirm("Excluir link?")&&(await d.delete(`/links/${e}`),await S())},Y=N.filter(e=>e.userId===(s==null?void 0:s.id)),pe=N.filter(e=>e.userId!==(s==null?void 0:s.id)),Z=[...Y].sort((e,a)=>e.title.localeCompare(a.title)),F=Math.ceil(Z.length/M)||1,xe=Z.slice((_-1)*M,_*M);return l.jsxs("div",{className:"min-h-screen flex flex-col",style:{backgroundColor:"var(--background-main)",color:"var(--text-color)"},children:[l.jsx(ye,{onMenuClick:()=>X(e=>!e),sidebarOpen:$}),l.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[l.jsxs(O.aside,{className:"w-64 p-6 space-y-4 transform transition-transform fixed top-16 bottom-0 left-0 z-20",style:{backgroundColor:"var(--card-background)",color:"var(--link-bar-text)"},initial:!1,animate:{x:$?0:-256},children:[l.jsxs(f,{to:"/",onClick:()=>X(!1),className:"mb-4 hover:underline flex items-center gap-1 px-2 py-1 rounded",children:[l.jsx(ee,{size:18})," Início"]}),l.jsx("nav",{className:"flex flex-col gap-2",children:s!=null&&s.isAdmin?l.jsxs(l.Fragment,{children:[l.jsxs(f,{end:!0,to:"/admin",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(ee,{size:18})," Dashboard"]}),l.jsxs(f,{to:"/admin/links",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(le,{size:18})," Links"]}),l.jsxs(f,{to:"/admin/files",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(je,{size:18})," Arquivos"]}),l.jsxs(f,{to:"/admin/categories",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(ke,{size:18})," Categorias"]}),l.jsxs(f,{to:"/admin/colors",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(Ne,{size:18})," Cores"]}),l.jsxs(f,{to:"/admin/users",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(be,{size:18})," Usuários"]})]}):l.jsxs(f,{to:"/user/links",className:({isActive:e})=>"hover:underline flex items-center gap-1 px-2 py-1 rounded",style:({isActive:e})=>e?{backgroundColor:"var(--hover-effect)"}:void 0,children:[l.jsx(le,{size:18})," Links"]})})]}),l.jsx("main",{className:`flex-1 p-4 md:p-8 transition-all ${$?"translate-x-64 md:translate-x-0 md:ml-64":"md:ml-0"}`,children:l.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",style:{color:"var(--text-color)"},children:l.jsxs("div",{className:"grid gap-8 md:grid-cols-2",children:[l.jsxs("section",{className:"bg-[var(--card-background)] rounded-2xl shadow-md hover:shadow-xl p-6",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Links Gerais"}),l.jsx("ul",{className:"space-y-2",children:pe.map(e=>{var i;const a=ae[((i=q[e.categoryId||0])==null?void 0:i.icon)||"Link2"];return l.jsxs("li",{className:"flex items-center gap-2",children:[a&&l.jsx(a,{size:16,className:"opacity-70"}),l.jsx("a",{href:e.url,target:"_blank",className:"flex-1 underline",children:e.title})]},e.id)})})]}),l.jsxs("section",{className:"bg-[var(--card-background)] rounded-2xl shadow-md hover:shadow-xl p-6",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:t?"Editar Link":"Novo Link"}),l.jsxs("form",{onSubmit:e=>t?me(e):de(e),className:"flex flex-col gap-3",children:[l.jsx("input",{className:u,placeholder:"Título",value:t?o.title:n.title,onChange:e=>t?m({...o,title:e.target.value}):p({...n,title:e.target.value})}),(s==null?void 0:s.isAdmin)&&l.jsxs("select",{className:u,value:t?h:b,onChange:e=>t?v(e.target.value):D(e.target.value),children:[l.jsx("option",{value:"link",children:"Link"}),l.jsx("option",{value:"file",children:"Arquivo"})]}),(t?h:b)==="link"||!(s!=null&&s.isAdmin)?l.jsx("input",{className:u,placeholder:"URL",value:t?o.url:n.url,onChange:e=>t?m({...o,url:e.target.value}):p({...n,url:e.target.value})}):l.jsxs("select",{className:u,value:t?o.file_url:n.file_url,onChange:e=>t?m({...o,file_url:e.target.value}):p({...n,file_url:e.target.value}),children:[l.jsx("option",{value:"",children:"Arquivo"}),oe.map(e=>l.jsx("option",{value:e.fileUrl,children:e.title},e.id))]}),l.jsxs("select",{className:u,value:t?o.category_id??"":n.category_id??"",onChange:e=>{const a=e.target.value===""?null:Number(e.target.value);t?m({...o,category_id:a}):p({...n,category_id:a})},children:[l.jsx("option",{value:"",children:"Categoria"}),E.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]}),l.jsxs("select",{className:u,value:t?o.color:n.color,onChange:e=>t?m({...o,color:e.target.value}):p({...n,color:e.target.value}),children:[l.jsx("option",{value:"",children:"Cor do card"}),re.map(e=>l.jsx("option",{value:e.value,style:{backgroundColor:e.value,color:"#000"},children:e.name?`${e.name} - ${e.value}`:e.value},e.id))]}),l.jsxs("select",{className:u,value:t?H:z,onChange:e=>t?w(e.target.value):V(e.target.value),children:[l.jsx("option",{value:"url",children:"URL"}),l.jsx("option",{value:"file",children:"Upload"})]}),(t?H:z)==="url"?l.jsx("input",{className:u,placeholder:"URL da imagem",value:t?o.image_url:n.image_url,onChange:e=>t?m({...o,image_url:e.target.value}):p({...n,image_url:e.target.value})}):l.jsx("input",{type:"file",accept:"image/*",className:u,onChange:e=>{var i;const a=((i=e.target.files)==null?void 0:i[0])??null;t?L(a):B(a)}}),(s==null?void 0:s.isAdmin)&&(t?h:b)==="link"&&l.jsxs(l.Fragment,{children:[l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:t?A:T,onChange:e=>t?x(e.target.checked):R(e.target.checked)}),"Possui arquivo"]}),(t?A:T)&&l.jsx("input",{type:"file",className:u,onChange:e=>{var i;const a=((i=e.target.files)==null?void 0:i[0])??null;t?g(a):P(a)}})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{type:"submit",className:"btn-primary px-4 py-2 rounded",children:t?"Salvar":"Adicionar"}),t&&l.jsx("button",{type:"button",onClick:()=>{C(null),x(!1),g(null),v("link"),k("/user/links")},className:"px-4 py-2 rounded border",children:"Cancelar"})]})]})]}),l.jsxs("section",{className:"bg-[var(--card-background)] rounded-2xl shadow-md hover:shadow-xl flex flex-col p-6 overflow-hidden",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["Seus Links (",Y.length,")"]}),l.jsx(O.ul,{className:"space-y-2 flex-1 overflow-y-auto",initial:{opacity:0},animate:{opacity:1},children:xe.map(e=>{var i,c;const a=ae[((i=q[e.categoryId||0])==null?void 0:i.icon)||"Link2"];return l.jsxs(O.li,{layout:!0,className:"flex items-center gap-2 bg-[var(--card-background)] text-white p-3 rounded-2xl shadow-md hover:shadow-xl",children:[l.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color||((c=q[e.categoryId||0])==null?void 0:c.color)}}),a&&l.jsx(a,{size:16,className:"opacity-70"}),e.url?l.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 underline",children:e.title}):l.jsx("span",{className:"flex-1",children:e.title}),e.fileUrl&&l.jsx("a",{href:e.fileUrl,className:"underline mr-2",target:"_blank",rel:"noopener noreferrer",children:"arquivo"}),l.jsx("button",{onClick:()=>ue(e),className:"p-1 hover:text-[var(--accent-color)]",children:l.jsx(Ce,{size:16})}),l.jsx("button",{onClick:()=>fe(e.id),className:"p-1 hover:text-red-400",children:l.jsx(_e,{size:16})})]},e.id)})}),F>1&&l.jsxs("div",{className:"flex justify-center gap-2 mt-2",children:[l.jsx("button",{disabled:_===1,onClick:()=>W(e=>Math.max(1,e-1)),className:"px-3 py-1 rounded border disabled:opacity-50",children:l.jsx(we,{size:16})}),l.jsxs("span",{className:"self-center",children:[_," / ",F]}),l.jsx("button",{disabled:_===F,onClick:()=>W(e=>Math.min(F,e+1)),className:"px-3 py-1 rounded border disabled:opacity-50",children:l.jsx(Le,{size:16})})]})]})]})})})]})]})}export{Se as default};
