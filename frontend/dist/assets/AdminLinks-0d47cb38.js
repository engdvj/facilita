import{u as ue,a as ce,r,j as l,m as Q,I as de,P as me,T as ge,C as pe,b as fe,c as u,V as L}from"./index-9567db93.js";function xe(){const{id:S}=ue(),E=ce(),[y,W]=r.useState([]),[U,X]=r.useState([]),[Y,Z]=r.useState([]),[ee,le]=r.useState([]),[n,m]=r.useState({title:"",url:"",file_url:"",user_id:null,category_id:null,color:"",image_url:""}),[F,M]=r.useState("url"),[q,A]=r.useState(null),[T,R]=r.useState(!1),[H,z]=r.useState(null),[P,ae]=r.useState([]),[h,V]=r.useState("link"),[s,_]=r.useState(null),[i,d]=r.useState({title:"",url:"",file_url:"",user_id:null,category_id:null,color:"",image_url:""}),[$,N]=r.useState("url"),[B,b]=r.useState(null),[C,x]=r.useState(!1),[G,v]=r.useState(null),[g,j]=r.useState("link");r.useEffect(()=>{h==="file"&&(R(!1),z(null))},[h]),r.useEffect(()=>{g==="file"&&(x(!1),v(null))},[g]);const[k,J]=r.useState(1),D=5,c="p-2 rounded-md border border-gray-300 dark:border-gray-700 bg-[var(--input-background)] text-white",K=r.useMemo(()=>{const e={};for(const a of U)e[a.id]=a;return e},[U]),w=async()=>{const[e,a,t,o,oe]=await Promise.all([u.get("/links"),u.get("/categories"),u.get("/colors"),u.get("/users"),u.get("/schedules")]);W([...e.data].sort((p,f)=>p.title.localeCompare(f.title))),X([...a.data].sort((p,f)=>p.name.localeCompare(f.name))),Z([...t.data].sort((p,f)=>(p.name||p.value).localeCompare(f.name||f.value))),le([...o.data].sort((p,f)=>p.username.localeCompare(f.username))),ae(oe.data)};r.useEffect(()=>{w()},[]),r.useEffect(()=>{if(S&&y.length){const e=y.find(a=>a.id===Number(S));e&&(_(e.id),d({title:e.title,url:e.url,file_url:e.fileUrl??"",user_id:e.userId??null,category_id:e.categoryId??null,color:e.color??"",image_url:e.imageUrl??""}),j(e.fileUrl?"file":"link"),N("url"),b(null),x(!!e.fileUrl),v(null))}else _(null),x(!1),v(null),j("link")},[S,y]);const te=async e=>{e.preventDefault();try{const a={...n};if(h==="file"&&(a.url=n.file_url),h==="link"&&T&&H){const t=new FormData;t.append("file",H);const o=await u.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}});a.file_url=o.data.url}if(F==="file"&&q){const t=new FormData;t.append("file",q);const o=await u.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}});a.image_url=o.data.url}a.category_id===null&&delete a.category_id,a.file_url||delete a.file_url,await u.post("/links",a),L.success("Link criado"),await w(),m({title:"",url:"",file_url:"",user_id:null,category_id:null,color:"",image_url:""}),A(null),M("url"),z(null),R(!1),V("link")}catch{L.error("Erro ao criar link")}},se=e=>{E(`/admin/links/${e.id}`),_(e.id),d({title:e.title,url:e.url,file_url:e.fileUrl??"",user_id:e.userId??null,category_id:e.categoryId??null,color:e.color??"",image_url:e.imageUrl??""}),N("url"),b(null),x(!!e.fileUrl),v(null)},re=async e=>{if(e.preventDefault(),s!==null)try{const a={...i};if(g==="file"&&(a.url=i.file_url),g==="link"&&C&&G){const t=new FormData;t.append("file",G);const o=await u.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}});a.file_url=o.data.url}else g==="link"&&!C&&(a.file_url=null);if($==="file"&&B){const t=new FormData;t.append("file",B);const o=await u.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}});a.image_url=o.data.url}a.category_id===null&&delete a.category_id,a.file_url||delete a.file_url,await u.patch(`/links/${s}`,a),L.success("Link atualizado"),_(null),b(null),N("url"),v(null),x(!1),j("link"),await w(),E("/admin/links")}catch{L.error("Erro ao atualizar")}},ie=async e=>{confirm("Excluir link?")&&(await u.delete(`/links/${e}`),await w())},O=[...y].sort((e,a)=>e.title.localeCompare(a.title)),I=Math.ceil(O.length/D)||1,ne=O.slice((k-1)*D,k*D);return l.jsx("div",{className:"p-4",style:{color:"var(--text-color)"},children:l.jsxs("div",{className:"admin-search-grid",children:[l.jsxs("section",{className:"bg-[var(--card-background)] rounded-2xl shadow-md hover:shadow-xl p-6",children:[l.jsx("h2",{className:"text-lg font-semibold mb-4",children:s?"Editar Link":"Novo Link"}),l.jsxs("form",{onSubmit:e=>s?re(e):te(e),className:"flex flex-col gap-3",children:[l.jsx("input",{className:c,placeholder:"Título",value:s?i.title:n.title,onChange:e=>s?d({...i,title:e.target.value}):m({...n,title:e.target.value})}),l.jsxs("select",{className:c,value:s?g:h,onChange:e=>s?j(e.target.value):V(e.target.value),children:[l.jsx("option",{value:"link",children:"Link"}),l.jsx("option",{value:"file",children:"Arquivo"})]}),(s?g:h)==="link"?l.jsx("input",{className:c,placeholder:"URL",value:s?i.url:n.url,onChange:e=>s?d({...i,url:e.target.value}):m({...n,url:e.target.value})}):l.jsxs("select",{className:c,value:s?i.file_url:n.file_url,onChange:e=>{const a=e.target.value;if(s){const t=P.find(o=>o.fileUrl===a);d({...i,file_url:a,user_id:(t==null?void 0:t.userId)??i.user_id,category_id:(t==null?void 0:t.categoryId)??i.category_id})}else{const t=P.find(o=>o.fileUrl===a);m({...n,file_url:a,user_id:(t==null?void 0:t.userId)??null,category_id:(t==null?void 0:t.categoryId)??null})}},children:[l.jsx("option",{value:"",children:"Arquivo"}),P.map(e=>l.jsxs("option",{value:e.fileUrl,children:[e.title,e.category?` [${e.category}]`:"",e.user?` - ${e.user}`:""]},e.id))]}),l.jsxs("select",{className:c,value:s?i.user_id??"":n.user_id??"",onChange:e=>{const a=e.target.value===""?null:Number(e.target.value);s?d({...i,user_id:a}):m({...n,user_id:a})},children:[l.jsx("option",{value:"",children:"Usuário"}),ee.map(e=>l.jsx("option",{value:e.id,children:e.username},e.id))]}),l.jsxs("select",{className:c,value:s?i.category_id??"":n.category_id??"",onChange:e=>{const a=e.target.value===""?null:Number(e.target.value);s?d({...i,category_id:a}):m({...n,category_id:a})},children:[l.jsx("option",{value:"",children:"Categoria"}),U.map(e=>l.jsx("option",{value:e.id,children:e.name},e.id))]}),l.jsxs("select",{className:c,value:s?i.color:n.color,onChange:e=>s?d({...i,color:e.target.value}):m({...n,color:e.target.value}),children:[l.jsx("option",{value:"",children:"Cor do card"}),Y.map(e=>l.jsx("option",{value:e.value,style:{backgroundColor:e.value,color:"#000"},children:e.name?`${e.name} - ${e.value}`:e.value},e.id))]}),l.jsxs("select",{className:c,value:s?$:F,onChange:e=>s?N(e.target.value):M(e.target.value),children:[l.jsx("option",{value:"url",children:"URL"}),l.jsx("option",{value:"file",children:"Upload"})]}),(s?$:F)==="url"?l.jsx("input",{className:c,placeholder:"URL da imagem",value:s?i.image_url:n.image_url,onChange:e=>s?d({...i,image_url:e.target.value}):m({...n,image_url:e.target.value})}):l.jsx("input",{type:"file",accept:"image/*",className:c,onChange:e=>{var t;const a=((t=e.target.files)==null?void 0:t[0])??null;s?b(a):A(a)}}),(s?g:h)==="link"&&l.jsxs(l.Fragment,{children:[l.jsxs("label",{className:"flex items-center gap-2",children:[l.jsx("input",{type:"checkbox",checked:s?C:T,onChange:e=>s?x(e.target.checked):R(e.target.checked)}),"Possui arquivo"]}),(s?C:T)&&l.jsx("input",{type:"file",className:c,onChange:e=>{var t;const a=((t=e.target.files)==null?void 0:t[0])??null;s?v(a):z(a)}})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{type:"submit",className:"btn-primary px-4 py-2 rounded",children:s?"Salvar":"Adicionar"}),s&&l.jsx("button",{type:"button",onClick:()=>{_(null),x(!1),v(null),j("link"),E("/admin/links")},className:"px-4 py-2 rounded border",children:"Cancelar"})]})]})]}),l.jsxs("section",{className:"bg-[var(--card-background)] rounded-2xl shadow-md hover:shadow-xl flex flex-col p-6 overflow-hidden",children:[l.jsxs("h2",{className:"text-lg font-semibold mb-4",children:["Links (",y.length,")"]}),l.jsx(Q.ul,{className:"space-y-2 flex-1 overflow-y-auto",initial:{opacity:0},animate:{opacity:1},children:ne.map(e=>{var t,o;const a=de[((t=K[e.categoryId||0])==null?void 0:t.icon)||"Link2"];return l.jsxs(Q.li,{layout:!0,className:"flex items-center gap-2 bg-[var(--card-background)] text-white p-3 rounded-2xl shadow-md hover:shadow-xl",children:[l.jsx("span",{className:"w-4 h-4 rounded",style:{backgroundColor:e.color||((o=K[e.categoryId||0])==null?void 0:o.color)}}),a&&l.jsx(a,{size:16,className:"opacity-70"}),e.url?l.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex-1 underline",children:e.title}):l.jsx("span",{className:"flex-1",children:e.title}),e.fileUrl&&l.jsx("a",{href:e.fileUrl,className:"underline mr-2",target:"_blank",rel:"noopener noreferrer",children:"arquivo"}),e.user&&l.jsx("span",{className:"text-xs px-2 py-1 rounded bg-slate-700 opacity-80",children:e.user}),l.jsx("button",{onClick:()=>se(e),className:"p-1 hover:text-[var(--accent-color)]",children:l.jsx(me,{size:16})}),l.jsx("button",{onClick:()=>ie(e.id),className:"p-1 hover:text-red-400",children:l.jsx(ge,{size:16})})]},e.id)})}),I>1&&l.jsxs("div",{className:"flex justify-center gap-2 mt-2",children:[l.jsx("button",{disabled:k===1,onClick:()=>J(e=>Math.max(1,e-1)),className:"px-3 py-1 rounded border disabled:opacity-50",children:l.jsx(pe,{size:16})}),l.jsxs("span",{className:"self-center",children:[k," / ",I]}),l.jsx("button",{disabled:k===I,onClick:()=>J(e=>Math.min(I,e+1)),className:"px-3 py-1 rounded border disabled:opacity-50",children:l.jsx(fe,{size:16})})]})]})]})})}export{xe as default};
